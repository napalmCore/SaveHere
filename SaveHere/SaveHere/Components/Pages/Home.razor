@page "/"
@using SaveHere.Components.Utility

@inject IDialogService DialogService

@rendermode InteractiveServer
@attribute [StreamRendering]

<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<PageTitle>SaveHere</PageTitle>

<LoadingIndicator IsLoaded="_isFullyLoaded">
  <div style="display: flex; justify-content:center; gap:0.5rem; margin-top:2rem; flex-wrap:wrap;">
    <MudCard Style="min-width:400px; max-width:100%;">
      <MudCardContent>
        <MudText Typo="Typo.h6">Direct Link</MudText>
        <MudText Typo="Typo.body2">Download files from direct links</MudText>
      </MudCardContent>
      <MudCardActions>
        <MudButton Variant="Variant.Text" Color="Color.Primary" style="margin-left: auto;" Href="downloadfromdirectlink">Continue</MudButton>
      </MudCardActions>
    </MudCard>

    <MudCard Style="min-width:400px; max-width:100%;">
      <MudCardContent>
        <MudText Typo="Typo.h6">Video/Audio</MudText>
        <MudText Typo="Typo.body2">
          Download Video/Audio from youtube/soundcloud/...
        </MudText>
        <MudText Typo="Typo.body2">
          See the full list of
          <MudLink OnClick="OpenSupportedSites"
                   Target="_blank"
                   Color="Color.Primary"
                   Typo="Typo.subtitle2">
            Supported Sites
          </MudLink>
        </MudText>
      </MudCardContent>
      <MudCardActions>
        <MudButton Variant="Variant.Text" Color="Color.Primary" style="margin-left: auto;" Href="downloadvideoaudio">Continue</MudButton>
      </MudCardActions>
    </MudCard>
  </div>
</LoadingIndicator>
@code {
  private bool _isFullyLoaded;

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    await base.OnAfterRenderAsync(firstRender);

    if (!firstRender) return;
    if (_isFullyLoaded) return;

    _isFullyLoaded = true;
    await InvokeAsync(StateHasChanged);
  }

  private void OpenSupportedSites()
  {
    var options = new DialogOptions
      {
        MaxWidth = MaxWidth.Large,
        FullWidth = true,
        CloseButton = true
      };

    DialogService.Show<MarkdownViewerDialog>("Supported Sites", options);
  }
}